name: "Transform Jobspec from Flux to Slurm"
steps:
   # The persona generates the Dockerfile
  - name: transform
    type: agent
    prompt: "transform_jobspec_persona"

    # Inputs that can be passed forward to next steps
    inputs:
      from_manager: "flux"
      to_manager: "slurm"
      script: |
        #!/bin/bash
        #FLUX -N 1
        #FLUX -n 64
        #FLUX -t 100s
        #FLUX -o cpu-affinity=per-task
        #FLUX --queue=pbatch
        #FLUX --setattr=container_image=ghcr.io/converged-computing/lammps-reax:ubuntu22.04
        #FLUX --output=job.{id}.out
        #FLUX --error=job.{id}.err
        #FLUX --job-name=lammps
        lmp -v x 8 -v y 8 -v z 8 -in in.reaxc.hns -nocite

    # This is the simplest case. The prompt above should generate
    # the input, and the agent SHOULD call a tool for transform.
    # We don't have a slurm validate, but when we flip to Slurm
    # to flux we can validate.
    transitions:
      failed: transform
      success: validate

   # The persona provides the jobspec and asks for the translation
   # In this case we will call the transform (manual) endpoint explicitly
  - name: validate
    type: agent    
    prompt: "flux_validate_jobspec_persona"

    # This gets jobspec from the function call output above.
    inputs:
      script: "{{ result.jobspec }}"